% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/models.R
\name{fit_all_tmb}
\alias{fit_all_tmb}
\title{Fit Spatial Models and Predict Relocation Impact}
\usage{
fit_all_tmb(
  sf_correct = NULL,
  sf_original = NULL,
  grid_in = NULL,
  formula = PM10 ~ 1,
  year_target = 2020,
  resolution = 1000,
  reference = NULL,
  likelihood = gaussian(),
  anisotropy = TRUE,
  log_transform = FALSE,
  invars = NULL
)
}
\arguments{
\item{sf_correct}{A \code{sf} object containing the corrected site data with
spatial and temporal information.}

\item{sf_original}{A \code{sf} object containing the original site data with
spatial and temporal information.}

\item{grid_in}{An optional \code{sf} object representing the grid for predictions.
If \code{NULL}, a grid is generated.}

\item{formula}{A formula specifying the model to be fitted
(e.g., \code{PM10 ~ 1}).}

\item{year_target}{An integer specifying the target year for filtering
the data (default: 2020).}

\item{resolution}{A numeric value specifying the resolution (cell size)
of the grid in meters (default: 1000).}

\item{reference}{A \code{sf} object used as a reference for generating the grid.}

\item{likelihood}{A family object specifying the likelihood function for
the model (default: \code{gaussian()}).}

\item{anisotropy}{A logical value indicating whether to include anisotropy
in the model (default: \code{TRUE}).}

\item{log_transform}{A logical value indicating whether to apply
a log transformation to the predictions (default: \code{FALSE}).}

\item{invars}{An optional vector of variable names to include
in the prediction.}
}
\value{
A list containing the following elements:
\describe{
\item{pred_correct}{A raster object of predictions for the corrected site data.}
\item{pred_original}{A raster object of predictions for the original site data.}
\item{pred_diff}{A raster object of the difference between the corrected and original predictions.}
}
}
\description{
This function fits spatial models using the \code{sdmTMB} package
for two sets of spatial data: corrected site data and original site data.
It then predicts the impact of relocation on a specified variable
(e.g., PM10) over a grid and computes the difference between
the predictions for the two datasets.
}
\details{
The function performs the following steps:
\enumerate{
\item Generates a grid for predictions if \code{grid_in} is not provided.
\item Filters and preprocesses the corrected and original site data
for the target year.
\item Creates mesh objects for spatial modeling using \code{sdmTMB::make_mesh}.
\item Fits spatial models for the corrected and original site data
using \code{fit_tmb}.
\item Predicts the target variable over the grid for both datasets
using \code{pred_tmb}.
\item Computes the difference between the predictions for the corrected and
original datasets.
}
}
\examples{
\dontrun{
result <- fit_all_tmb(
  sf_correct = corrected_sites,
  sf_original = original_sites,
  formula = PM10 ~ 1,
  year_target = 2020,
  resolution = 1000,
  reference = reference_sf
)
plot(result$pred_diff)
}

}
